# 分库分表

分库分表是数据库设计中的一种优化策略，旨在提高系统的性能和可扩展性。它通过将数据分散到多个数据库或表中来减少单个数据库的负载。

## 1. 为什么要分库分表

1. **性能提升**：随着数据量的增加，单个数据库的查询和写入性能可能会下降。分库分表可以将负载分散到多个数据库或表中，从而提高性能。
2. **可扩展性**：当数据量持续增长时，分库分表可以更容易地扩展系统。可以通过增加新的数据库或表来处理更多的数据。
3. **维护性**：分库分表可以使得每个数据库或表的结构更简单，便于维护和管理。
4. **资源有限**：在资源有限的情况下，分库分表可以更好地利用现有资源，避免单个数据库过载。

## 2. 分库分表的策略

分库分表可以根据不同的策略进行，常见的策略包括：

- **水平分割**：将数据按行分割到不同的表或数据库中。例如，可以根据用户ID将用户数据分布到多个表中。
- **垂直分割**：将数据按列分割到不同的表或数据库中。例如，将用户的基本信息和账户信息分到不同的表中。
- **混合分割**：结合水平和垂直分割的方式，根据具体业务需求进行数据分布。

### 2.1 垂直拆分

垂直拆分是将一个表中的不同列分到多个表中，每个表只包含部分列。这种方式可以减少单个表的复杂性，提高查询效率。一般实践中，垂直拆分主要根据业务逻辑或功能模块进行划分。

- 垂直分库
    垂直分库是将不同的业务模块或功能划分到不同的数据库中。例如，商品库Products、订单库Orders、用户库Users等。每个数据库只包含与其相关的表和数据。
    > 垂直分库可以根据业务场景孵化，实行较为容易。
- 垂直分表
    垂直分表是将一个表中的不同列分到多个表中。例如，将用户表拆分为用户基本信息表和用户详细信息表。
    > 垂直分表可以减少单个表的复杂性，提高查询效率。比如可以根据数据访问频率进行冷热拆分；或者根据字段类型，功能用途进行拆分。
    > 但是单表依旧容易数据量膨胀，并且部分业务表无法join

### 2.2 水平拆分

水平拆分又分为库内分表和分库分表，用于解决单个数据表数据量过大导致的性能问题。

- 库内分表
    库内分表是将一个数据库中的表按照某种规则拆分成多个表。例如，可以将用户表按照用户ID的范围拆分为用户表1、用户表2等。
    > **实现策略**：
    > - 范围分表：根据某个字段的范围将数据分到不同的表中。
    > - 哈希分表：根据某个字段的哈希值将数据分到不同的表中。
    > - 列表分表：根据某个字段的具体值将数据分到不同的表中。
    > - 键值分表：根据某个字段的键值采用hash算法分表。
    > - 混合分表：复合多种分表策略，根据业务需求进行数据分布。
- 分库分表
    分库分表是将数据分散到多个数据库中，每个数据库中又可以包含多个表。例如，可以将用户数据分布到不同的数据库中，每个数据库中包含用户表和相关的其他表。
    > **存在问题**：
    > - 跨库查询复杂：分库后，跨库查询变得复杂，可能需要在应用层进行聚合。
    > - 事务处理困难：跨库事务处理变得困难，可能需要使用分布式事务方案。
    > - 数据一致性问题：不同数据库之间的数据一致性难以保证。
