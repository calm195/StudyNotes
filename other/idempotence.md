# 幂等性

幂等性是指一个操作可以重复执行多次，但其结果不会改变。换句话说，无论执行多少次，最终的状态都是相同的。
> 例如，创建订单接口，对于同一个订单的创建请求，无论发送多少次，最终只会创建一次订单。

## 前端实现

- **按钮去抖动**：例如，在用户点击“提交”按钮时，可以在短时间内忽略后续的点击事件，从而避免重复提交请求。
- **页面重定向**：在用户提交表单后，可以通过页面重定向的方式跳转到成功页面，从而避免用户重复提交表单。

## 后端实现

1. **唯一性约束**：在数据库中为某些字段添加唯一性约束，例如订单号、用户ID等。
    > 生成全局唯一ID的方案一般有：
    > - UUID：全局唯一标识符，32位16进制数，128位二进制数。
    > - Twitter的Snowflake算法：64位二进制数，41位时间戳，10位机器ID，12位序列号。
    > - 数据库自增主键或Redis自增ID。
2. **幂等性键**：在请求中添加一个唯一的幂等性键（如UUID），服务器在处理请求时检查该键是否已存在。如果存在，则直接返回之前的结果；如果不存在，则处理请求并保存结果。
3. **乐观锁**：在处理数据时，使用版本号或时间戳等方式来确保数据的一致性。例如，在更新订单状态时，可以检查当前状态是否与预期状态一致，如果一致则更新，否则返回错误。
4. **状态机**：使用状态机来管理操作的状态，确保每个操作只能在特定的状态下执行。例如，订单的状态可以是“待支付”、“已支付”、“已发货”等，每个状态下只能执行特定的操作。
5. **分布式锁**：在分布式系统中，可以使用分布式锁来确保同一时间只有一个实例在处理某个操作。例如，使用Redis的SETNX命令来实现分布式锁。
